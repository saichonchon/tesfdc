<apex:page standardcontroller="Opportunity" title="Qualifier Assessment" extensions="ExtOppy_qualifierAccessment" showHeader="false" sidebar="false">
<!-- Begin Default Content REMOVE THIS -->
<!-- End Default Content REMOVE THIS -->
<link href="{!URLFOR($Resource.jsCss4OrgChart,'/css/ui-lightness/jquery-ui-1.10.4.custom.css')}" rel="stylesheet"></link>
<script type="text/javascript" src="{!URLFOR($Resource.jsCss4OrgChart,'/js/jquery-1.10.2.min.js')}"></script>
  <script type="text/javascript" src="{!URLFOR($Resource.jsCss4OrgChart,'/js/jquery-ui-1.10.4.custom.min.js')}"></script>
  <script type="text/javascript" src="{!URLFOR($Resource.jsCss4OrgChart,'/js/jquery.json-2.4.min.js')}"></script>
  <script type="text/javascript" src="{!URLFOR($Resource.jsCss4OrgChart,'/js/jquery.placeholder.min.js')}"></script>
  <script src="{!URLFOR($Resource.jQueryTool, '/glob-cultures/globalize.js')}" type="text/javascript"></script>

  <script src="{!URLFOR($Resource.jQueryTool, lc.jsPath)}" type="text/javascript"></script>
<style type="text/css">
    .success, .process, .failed, .document, .comment, .edit, .process-cursor-icon, .content-title-right-icon, .table-title-icon, .process-info {
        background: url({!URLFOR($Resource.jsCss4OrgChart,'css/ui-lightness/images/icon.png')}) no-repeat;
    }
    .process-info { 
        height: 32px;
        width: 32px;
        display: inline-block;
        text-indent: -10000px;  
        vertical-align: top; 
    }
    .accordion-title .process-info.success {
        background-position: 0 -29px;
    }
    .accordion-title .process-info.process {
        background-position: -40px -29px; 
    }
    .accordion-title .process-info.failed {
        background-position: -76px -29px;
    }
    .ui-state-active .process-info.success, .ui-state-hover .process-info.success, .ui-state-focus .process-info.success {
        background-position: -119px -29px;
    }
    .ui-state-active .process-info.process, .ui-state-hover .process-info.process, .ui-state-focus .process-info.process {
        background-position: -159px -29px;
    }
    .ui-state-active .process-info.failed, .ui-state-hover .process-info.failed, .ui-state-focus .process-info.failed {
        background-position: -197px -29px;
    }
    .ui-state-active .step-name, .ui-state-hover .step-name, .ui-state-focus .step-name {
        color: #fff;
    }
    body {
        font-size: 12px;
    }
    .step-name {
        color: #333333;
        display: inline-block;
        font-size: 1.2em;
        left: 13px;
        margin-top: 0; 
        position: relative;
        top: 5px;
    }
    .ques-icon-con {
        background: none;
        height: 26px;
        display: inline-block;
        position: relative;
        padding-top: 3px;
        width: 280px;
    }
    .space {
        background: none;
        display: inline-block;
        height: 26px;
        width: auto;
        margin-right: 20px;
    }
    .ques-icon {
        height: 26px;
        width: 26px;
        display: inline-block;
        background-color: none;
    }
    .ui-state-active .success, .ui-state-hover .success, .ui-state-focus .success {
        background-position: -176px 0;
    }
    .success {
        background-position: 0 0; 
    }
    .ui-state-active .process, .ui-state-hover .process, .ui-state-focus .process {
        background-position: -237px 0;
    }
    .process {
        background-position: -79px 0;
    }
    .ui-state-active .failed, .ui-state-hover .failed, .ui-state-focus .failed {
        background-position: -207px 0;
    }
    .failed {
        background-position: -40px 0;
    }
    .ui-state-active .process-con, .ui-state-hover .process-con, .ui-state-focus .process-con {
        border-color: #e08f00;
    }
    .process-con {
        background: #fff;
        width: 260px;
        height: 20px;
        display: inline-block;
        border-radius: 7px;
        text-align: left;
        border: 1px solid #c1c1c1;
        margin: 5px 20px 0 0;
        vertical-align: top;
        position: relative;
    }
    .percent {
        color: #333;
        font-size: 14px;
        font-weight: bold;
        left: 0;
        right: 0;
        text-align: center;
        position: absolute;
        top: 0;
    }
    .process-total{
        background: #EF110F;
        width: 100%;
        height: 5px;
        margin:5px auto;
        display: inline-block;
    }
    .process-status.process{
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f6d311', endColorstr='#c9aa0c',GradientType=0 ); 
        background: linear-gradient(#f6d311, #c9aa0c);
    }
    .process-status.failed{
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#da241e', endColorstr='#ab0806',GradientType=0 ); 
        background: linear-gradient(#da241e, #ab0806);
    }
    .process-status {
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#c4db12', endColorstr='#83b20e',GradientType=0 ); 
        background: linear-gradient(#c4db12, #83b20e);
        display: inline-block;
        height: 20px;
        border-radius: 6px;
    }
    .process-all{
        background-color:#DCE8F5;
        height: 5px;
    }
    .process-finished{
        background-color:#5C7FA8; 
        height: 5px;
    }
    .Acc-content{
        overflow: hidden;
        border-radius: 4px;
        border:1px solid #c5c5c5;
        margin: 0 0 6px;
        background-color:#fff;
        box-shadow: 0 2px 12px -9px #000; 
        height: 125px;

    }
    .Acc-content textarea{
        height:60px;
        border:1px solid #cfcfcf;
        border-radius: 6px;
    }
    
    .content-div {
        height: 125px;
    }
    .question-con {
        width:61%;
        float:left;
        margin: 5px 5% 5px 0;

    }
    .question-con textarea, .question-con span {
        display: block;
        width: 100%;
    }
    .question-con textarea {
        margin-top: 10px;
        resize:none;
    }
    .comment-con {
        width:6%;
        float:left;
        margin: 15px 0 0;
    }
    .answer-con {
        width:24%;
        float:right;
        margin: 0;
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#006a82', endColorstr='#005365',GradientType=0 ); 
        background: linear-gradient(#006a82, #005365);
        position: relative;
    }
    .answer-con label.load, .cycle_container label.load {
        display: none;
        height: 16px;
        width: 16px;
        position: absolute;
        top: 17px;
        right: 25px;
        background: url(/img/loading.gif) no-repeat;
    }
    .cycle_container label.load {
        right: 0;
        top: 0;
        position: relative;
        margin-left: 20px;
        float: left;
    }
    .answer-con .title {
        margin-right: 12%;
        float: left;
        display: inline-block;
    }
    .answer-con .date {
        margin: 7px 0 0 11%;
        color: #fff;
        line-height: 39px;
        display: block;
        overflow: hidden;
    }
    .answer-con select {
        float: left;
        margin: 0 6.5% 0 11%;
        height: 32px;
        width: 63%;
        padding: 4px 0;
        font-size: 15px;
        background: #fffffe;
    }
    .document{
        float:right;
        border-radius: 4px;
        height: 16px;
        width: 25px;
        background-position: -164px -23px;
    }
    .document-info{
        display:none;
        position:absolute;
        width:300px;
        height:100px;
        top:22%;
        right:7%;
        z-index: 111;
        background-color:#66FFFF;
    }
    
    .accordion-title{
        background-color:#CFDAEB;
        background-image:none;
    }
    .accordion-content{
        background-color:#f49d02;
        background-image:none;
    }
    .ques-info {
        margin-top: -19px;
        margin-left: 238px;
    }


    .content-div .ques-icon {
        margin: 4px 0 0;
    }
    .content-div .success {
        background-position: -266px 0;
    }
    .content-div .process {
        background-position: -323px 0;
    }
    .content-div .failed {
        background-position: -295px 0;
    }
    .required {
        width: 9px;
        background: ＃fff;/*#b31717;*/
        float: left;
        height: 125px;
        margin-right: 2%;
    }
    .no-sel {
        background: transparent;
    }
    .ques-failed {
        background: #fff;
    }
    .comment {
        height: 28px;
        width: 42px;
        background-position: -49px -65px;
        color: #fff;
        display: block;
        margin-right: 2%;
    }
    .edit {
        background-position: -49px -99px;
        height: 28px;
        width: 42px;
        display: block;
        margin-right: 2%;
        margin-top: 6px;
        position: relative;
    }
    .doc-list {
        margin: 0;
        padding: 0px;
        list-style: none;
        display: none;
    }
    .doc-list li{
        float: left;
        width: 200px;
        margin: 0;
        padding: 0;
        line-height: 24px;
    }
    .comment.sel {
        background-position: 0 -65px;
    }
    .edit.sel {
        background-position: 0 -99px;
        cursor: pointer;
    }








    .content-title{
        width:100%;
        height:160px;
        background-color:#fff;
        padding-left: 5px;
        border-radius: 5px;
        margin-bottom:10px;
    }
    .content-title-left,.content-title-right{
        width:45%;
        float:left;
    }
    .content-title-left{
        margin-right:8%;
    }
    .fistDate{
        width:auto;
        display:inline-block;
    }
    .endDate{
        width:auto;
        float:right;
        display:inline-block;
        color:#EF110F;
    }
    .content-title-left-function{
        margin:10px 0px 5px;
        text-align:center;
    }
    .content-title-left-function div{
        width:30%;
        height:40px;
        border-radius: 3px;
        border:1px solid #EFEDEF;
        display: inline-block;
    }
    .content-title-left-function div:nth-child(1){
        float:left;
    }
    .content-title-left-function div:nth-child(3){
        float:right;
    }
    .content-title-process-con{
        background-color:#E6E5E7;
    }
    .content-title-right table{
        margin:auto;
    }
    .content-title-count{
        font-size:22px;
        color:#5C7FA8;
        float:right;
        display: inline-block;
    }
    .content-title-left-function div > span:nth-child(1){
        text-align:center;
        font-size:16px;
        line-height:40px;
    }
    .content-title-spanIcon2{
        font-family:Arial;
        font-weight: bold;
    }
    .content-title-spanIcon2 span:nth-child(1){
        font-size:20px;
        color:#5C7FA8;
    }
    .content-title-spanIcon2 span:nth-child(2){
        font-size:20px;
        color:#E6E5E7;
    }
    .content-title-spanIcon3{
        font-size:18px;
    }
    .content-title-spanIcon3 span:nth-child(1){
        color:#EF110F;
    }
    .content-title-spanIcon3 span:nth-child(2){
        color:#E6E5E7;
    }
    .drow-round{
        width:10px;
        height:10px;
        border-radius:15px;
        border:4px solid #DCE8F5;
        background-color:#5C7FA8;
        margin-top: 25px;
        margin-left: -1px;
        position: absolute;
    }
    .drow-round:nth-child(2){
        margin-top:25px;
        right: -5px;
    }
    .process-status-low {
        background: #ffb930;
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#FEC842', endColorstr='#FFAA19',GradientType=0 ); 
        background: linear-gradient(#FEC842, #FFAA19);
    }
    .process-cursor{
        color: #5C7FA8;
        left: 58.4%;
        margin-left: -16px;
        position: relative;
    }
    .process-cursor-icon{
        width:12px;
        height:9px;
        background-position: -223px -136px;
        display: block;
        -moz-transform:rotate(90deg);
        -webkit-transform:rotate(90deg);
        -o-transform:rotate(90deg);
        margin-left: 10px;
    }
    .content-title-right-icon{
        width:11px;
        height:11px;
        display:inline-block;
        margin:0px 0px 0px 73%;
        background-position: -197px -136px;
    }
    .table-title-icon{
        width:12px;
        height:9px;
        background-position: -224px -136px;
        display: inline-block;
    }
    .content-title-right table tr:not(.table-changeColor) td:nth-child(1) span{
        display:none;
    }
    .table-changeColor td:nth-child(2){
        color:#5C7FA8;
    }
    .title-count-part{
        position: relative;
    }
    .ui-accordion .ui-accordion-header .set-right {
        right: 0.5em;
        margin-top: -11px;
        position: absolute;
        top: 50%;
    }
    
    .ui-state-default .set-right {
        background-position: -118px 0;
    }
    .ui-state-active .set-right {
        background-position: -147px 0;
    }
    .ques-content{
        background: #fff;   
        padding: 6px;
    }
    #doc-con {
        display: none;
        overflow: hidden;
        position: absolute;
        z-index: 1;
    }
    #doc-con .doc-list {
        display: block;
    }
    
    
    /*---- Mask ----**/
    #mask {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        text-align: center;
        z-index: 3000;
        background-color: #fff;
        background-repeat: no-repeat;
        background-position: 50% 20%;
        background-image: url({!URLFOR($Resource.jsCss4OrgChart,'css/ui-lightness/images/loading32.gif')});
        filter: alpha(opacity = 85);
        opacity: .85;
        display: none;
    }
    #progressbar {
        position: relative;
        top: 50%;
        margin-top: 30px;
        width: 80%;
        margin-left: auto;
        margin-right: auto;
        display: none;
    }
    /*---- Mask ----**/ 
    #tabs, .topButton {
        width: 1010px;
        margin: 0px auto;
        border: 0;
        padding: 0px;
        position:relative;
    }
    .ui-accordion .ui-accordion-icons {
        padding-left: 26px;
    }
    .ui-accordion .ui-accordion-header-active {
        padding-left: 27px;
    }
    .ui-accordion .accordion-disabled .ui-accordion-header-icon, .ui-accordion .accordion-disabled .set-right {
        display: none;
    }
    .tab-back{
        width:99px !important;
        height:62px;
        cursor: pointer;
    }
    .backIcon{
        width:7px;
        height:28px;
        display:inline-block;
        margin: 18px 6px 0px 7px;
        float: left;
        background-image: url({!URLFOR($Resource.jsCss4OrgChart,'css/ui-lightness/images/icon.png')});
        background-position: -107px -99px;
    }
    .backIcon + label{
        margin-top: 14px;
        display: inline-block;
        color:#6d6d6d;
        cursor: pointer;
    }
    
    #popup-back{
        opacity: 0.3;
        filter:alpha(opacity=30);
        position: fixed;
        top: 0;
        left: 0;
        z-index: 60;
        background-color: #000;
        border: none;
        width:100%;
        height:100%;
        display:none;
    }
    .refresh-popup, .error-popup{
        width:400px;
        z-index: 61;
        text-align: center;
        background:#ffffff;
        position: absolute;
        border-radius: 4px;
        padding: 0px 5px;
        margin-left: -205px;
        left:50%;
        top:30%;
        display:none;
    }
    .popup-title{
        width:100%;
        height:41px;
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#006a82', endColorstr='#005467',GradientType=0 ); /* IE6-9 */
        background: linear-gradient(#006a82, #005467);
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
        text-align: left;
    }
    .popup-title span {
        display: inline-block;
        color: #ffffff;
        line-height: 41px;
        padding-left: 14px;
        font-weight: bold;
    }
    .error-popup p{
        font-weight: bold;
        color:red;
        padding: 10px 10px;
    }
    .refresh-button, .error-button{
        height:28px;
        border:1px solid #da8d00;
        padding: 0px 12px;
        border-radius: 6px;
        line-height: 28px;
        font-weight: bold;
        font-size: 14px;
        color:#ffffff;
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f9b30f', endColorstr='#ef8f03',GradientType=0 ); /* IE6-9 */
        background: linear-gradient(#f9b30f, #ef8f03);
        margin-bottom: 10px;
        cursor:pointer;
    }
    .cycle_container {
        position: fixed;
        background: #ffffff;
        overflow: hidden;
        width:100%;
        height: 93px;
        z-index: 59;
        padding-top: 20px;
        padding-bottom: 10px;
        top: 77px;
    }
    .cycle_container > * {
        float: left;
        margin-top: 9px;
    }
    .cycle_container select {
        margin: 18px 0 0 0px;
        vertical-align: middle;
        width: 197px;
        height: 22px;
        border-radius: 6px;
        border: 1px solid #cfcfcf;
    }
    .cycle_container textarea {
        vertical-align: middle;
        height: 60px;
        width: 753px;
        resize: none;
        padding: 0px;
        margin: 0 0 0 20px;
        border-radius: 6px;
        border: 1px solid #cfcfcf;
    }
    .cycle_container > h3 {
        width: 100%;
        font-size: 1.2em;
    }
    .arrow-button{
        position: relative;
        width: 20px;
        height: 20px;
        margin: 4px 0 0 0;
        float:left;
    }
    .arrow-border, .arrow-content{
        width: 0;
        height: 0;
        overflow: hidden;
        border-width: 10px;
        border-style: dashed dashed dashed solid;
    }
    .arrow-border{
        border-color: transparent transparent transparent #dd9513;
    }
    .arrow-content{
        border-color: transparent transparent transparent #ffffff;
        position: absolute;
        top: 0px;
        left:-1px;
    }
    .popup-content{
        width:170px;
        min-height:26px;
        float:left;
        border-radius: 4px;
        background: #ffffff;
        border: 1px solid #dd9513;
    }

    .floatLoading{
        position: fixed;
        z-index: 59;
        top: 30px;
        color: #006177;
        font-weight: bold;
        width: 100%;
        margin-left: 870px;
        display: none;
    }
    .floatLoading span{
        display: inline-block;
        margin-top: 7px;
        float: left;
    }
    .floatLoading img{
        display: inline-block;
        margin-top: 0px;
        float: left;
    }
    .placeholder {
        color: #bfbfbf;
    }
    
    
    .floatStyle{
        position: fixed; 
        z-index: 9;
        padding: 10px 0px 3px !important;
        margin:0px;
        top: 0px;
        width: 100%;
        background: #ffffff;
    }
    .tab-back{
        width:99px !important;
        height:62px;
        cursor: pointer;
        font-weight: bold;
    }
    .inlineEditDiv {
        width: 580px;
    } 
    .inlineEditWrite, .inlineEditWriteOn {
        float: right;
        width: 580px;
    }
    .inlineEditDiv input {
        width: 555px;
    }
    .backIcon{
        width:7px;
        height:28px;
        display:inline-block;
        margin: 18px 6px 0px 7px;
        float: left;
        background-image: url({!URLFOR($Resource.jsCss4OrgChart,'css/ui-lightness/images/icon.png')});
        background-position: -107px -99px;
    }
    .backIcon + label{
        margin-top: 14px;
        display: inline-block;
        color:#6d6d6d;
        cursor: pointer;
    }

    .topButton > ul li,.ui-tabs .ui-tabs-nav li {
        list-style: none;
        float: left;
        position: relative;
        top: 0;
        margin: 1px 14px 0 0;
        border-bottom-width: 0;
        padding: 0;
        white-space: nowrap;
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#d8d8d8',GradientType=0 ); 
        background: linear-gradient(#fff, #d8d8d8);
        color: #1b1b1b;
        border-radius: 4px;
        border: 1px solid #ccc;
        width: 168px;
    }
    .topButton > ul li.sel,.ui-tabs .ui-tabs-nav li.sel {
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#3e3e3e', endColorstr='#272727',GradientType=0 ); 
        background: linear-gradient(#3e3e3e, #272727);
        color: #cfcfcf;
        border: 0;
        border-top: 1px solid #3e3e3e;
        border-bottom: 1px solid #272727;
        width: 168px;
    }
    .topButton > ul li.sel a {
        color: #fff;
    }
    .topButton > ul li a{
        float: left;
        padding: .5em 0;
        width: 100%;
        text-align: center;
        text-decoration: none;
        line-height: 24px;
        font-size: 14px;
        font-weight: bold;
    }
    .topButton > ul li a span {
        display: block;
        font-size: 12px;
        font-weight: normal;
    }
    .topButton > ul li div{
        width: 175px;
        height: 66px;
        top: -1px;
        left: -1px;
        position: absolute;
        z-index: 11;
        filter: alpha(opacity=70);
        -moz-opacity: 0.7;
        opacity: 0.7;
        background: #ffffff;
    }
</style>
<script>
    var actionFlag = true, 
        cycleActionFlag = true,
        remoteQues = new Array(), 
        oppy = {!jsonString},
        oppyjson = {!oppyjson},
        buyercycle = {!buyingCyclePickList};
    //var oppy = [{"threshold":90.0,"os":{"attributes":{"type":"OpportunityStage","url":"/services/data/v29.0/sobjects/OpportunityStage/01JL000000272xPMAQ"},"Id":"01JL000000272xPMAQ","MasterLabel":"Initiating"},"map_spqaId_list_qdocs":{},"list_questions":[{"rating":4,"question":"During a meeting/call, the customer shared an Implied or Explicit Need that a TE solution can address.","id":"a0KL0000002e6M9MAI","helpComment":"During a meeting/call, the customer shared an Implied or Explicit Need that a TE solution can address."},{"rating":4,"question":"The customer has agreed to provide access to FOD(s).","id":"a0KL0000002e6MjMAI","helpComment":"The customer has agreed to provide access to FOD(s)."}],"list_answers":[{"status":"Yes","questionId":"a0KL0000002e6M9MAI","lastModifyDate":"20.02.2014","comment":"test"},{"status":"No","questionId":"a0KL0000002e6MjMAI","lastModifyDate":"20.02.2014","comment":null}]},{"threshold":70.0,"os":{"attributes":{"type":"OpportunityStage","url":"/services/data/v29.0/sobjects/OpportunityStage/01JL000000272xLMAQ"},"Id":"01JL000000272xLMAQ","MasterLabel":"Exploring Needs"},"map_spqaId_list_qdocs":{},"list_questions":[{"rating":4,"question":"Focus on Dissatisfaction(s) have revealed Explicit Needs and Payoffs.","id":"a0KL0000002e6MaMAI","helpComment":"Focus on Dissatisfaction(s) have revealed Explicit Needs and Payoffs."},{"rating":3,"question":"The customer has shared how this opportunity will be sponsored (budget and within the customer organisation)","id":"a0KL0000002e6LnMAI","helpComment":"The customer has shared how this opportunity will be sponsored (budget and within the customer organisation)"},{"rating":4,"question":"Engineering Project:   Lean PD G0 approved","id":"a0KL0000002e6NmMAI","helpComment":"Engineering Project:   Lean PD G0 approved"},{"rating":3,"question":"Have you identified that this opportunity  meets the  five criteria for “intent to act”?","id":"a0KL0000002e6NcMAI","helpComment":"Have you identified that this opportunity  meets the  five criteria for “intent to act”?"},{"rating":2,"question":"You have confirmed that this opportunity is in the Recognition of Needs phase of The Buying Cycle.","id":"a0KL0000002e6MyMAI","helpComment":"You have confirmed that this opportunity is in the Recognition of Needs phase of The Buying Cycle."},{"rating":3,"question":"The customer has shared the decision making process for this specific opportunity, including buyer roles.","id":"a0KL0000002e6NIMAY","helpComment":"The customer has shared the decision making process for this specific opportunity, including buyer roles."},{"rating":2,"question":"The customer has shared TE's competitors for this opportunity.","id":"a0KL0000002e6NSMAY","helpComment":"The customer has shared TE's competitors for this opportunity."},{"rating":2,"question":"You have confirmed that this opportunity is in the Recognition of Needs phase of The Buying Cycle.","id":"a0KL0000002e6ReMAI","helpComment":"You have confirmed that this opportunity is in the Recognition of Needs phase of The Buying Cycle."},{"rating":4,"question":"Focus on Dissatisfaction(s) have revealed Implied Needs and Implications.","id":"a0KL0000002e6MBMAY","helpComment":"Focus on Dissatisfaction(s) have revealed Implied Needs and Implications."}],"list_answers":[{"status":"Yes","questionId":"a0KL0000002e6MaMAI","lastModifyDate":"25.02.2014","comment":null},{"status":"No","questionId":"a0KL0000002e6LnMAI","lastModifyDate":"25.02.2014","comment":null},{"status":"No","questionId":"a0KL0000002e6NmMAI","lastModifyDate":"25.02.2014","comment":null},{"status":"No","questionId":"a0KL0000002e6NcMAI","lastModifyDate":"25.02.2014","comment":null},{"status":"Yes","questionId":"a0KL0000002e6MyMAI","lastModifyDate":"20.02.2014","comment":null},{"status":"No","questionId":"a0KL0000002e6NIMAY","lastModifyDate":"20.02.2014","comment":null},{"status":"Yes","questionId":"a0KL0000002e6NSMAY","lastModifyDate":"19.02.2014","comment":null},{"status":"In Progress","questionId":"a0KL0000002e6ReMAI","lastModifyDate":"20.02.2014","comment":null},{"status":"Yes","questionId":"a0KL0000002e6MBMAY","lastModifyDate":"20.02.2014","comment":null}]},{"threshold":75.0,"os":{"attributes":{"type":"OpportunityStage","url":"/services/data/v29.0/sobjects/OpportunityStage/01JL000000272xUMAQ"},"Id":"01JL000000272xUMAQ","MasterLabel":"Developing & Differentiating"},"map_spqaId_list_qdocs":{},"list_questions":[{"rating":3,"question":"The customer has given you feedback on your initial solution recommendation against their decision criteria.","id":"a0KL0000002e6OLMAY","helpComment":"The customer has given you feedback on your initial solution recommendation against their decision criteria."},{"rating":2,"question":"You have confirmed that this opportunity is in the Evaluation of Options phase  of The Buying Cycle.","id":"a0KL0000002e6NEMAY","helpComment":"You have confirmed that this opportunity is in the Evaluation of Options phase  of The Buying Cycle."},{"rating":4,"question":"The customer has agreed to a final solution recommendation to the FOP. ","id":"a0KL0000002e6OJMAY","helpComment":"The customer has agreed to a final solution recommendation to the FOP. "},{"rating":4,"question":"The customer has shared decision criteria and their ranking of importance.","id":"a0KL0000002e6OGMAY","helpComment":"The customer has shared decision criteria and their ranking of importance."},{"rating":2,"question":"Project have been fully defined in a Project Meeting and core/secondary requirements have been agreed","id":"a0KL0000002e6O2MAI","helpComment":"Project have been fully defined in a Project Meeting and core/secondary requirements have been agreed"}],"list_answers":[{"status":"Yes","questionId":"a0KL0000002e6OLMAY","lastModifyDate":"20.02.2014","comment":null},{"status":"Yes","questionId":"a0KL0000002e6NEMAY","lastModifyDate":"20.02.2014","comment":null},{"status":"Yes","questionId":"a0KL0000002e6OJMAY","lastModifyDate":"20.02.2014","comment":null},{"status":"Yes","questionId":"a0KL0000002e6OGMAY","lastModifyDate":"20.02.2014","comment":null},{"status":"Yes","questionId":"a0KL0000002e6O2MAI","lastModifyDate":"20.02.2014","comment":null}]},{"threshold":80.0,"os":{"attributes":{"type":"OpportunityStage","url":"/services/data/v29.0/sobjects/OpportunityStage/01JL000000272xZMAQ"},"Id":"01JL000000272xZMAQ","MasterLabel":"Refining & Resolving"},"map_spqaId_list_qdocs":{},"list_questions":[{"rating":4,"question":"The customer informed you that TE has been selected as the preferred option.","id":"a0KL0000002e6P4MAI","helpComment":"The customer informed you that TE has been selected as the preferred option."},{"rating":2,"question":"A negotiating strategy has been agreed upon with your manager.","id":"a0KL0000002e6OkMAI","helpComment":"A negotiating strategy has been agreed upon with your manager."},{"rating":3,"question":"The negotiable issues have been agreed with the customer.","id":"a0KL0000002e6OpMAI","helpComment":"The negotiable issues have been agreed with the customer."},{"rating":2,"question":"You have confirmed that this opportunity is in the Resolution of Concerns stage of the Buying Cycle.","id":"a0KL0000002e6NPMAY","helpComment":"You have confirmed that this opportunity is in the Resolution of Concerns stage of the Buying Cycle."},{"rating":3,"question":"The customer  has confirmed that you have identified and addressed all Consequences in moving forward with TE.","id":"a0KL0000002e6LFMAY","helpComment":"The customer  has confirmed that you have identified and addressed all Consequences in moving forward with TE."},{"rating":3,"question":"FOP has provided feedback on your final solution recommendation.","id":"a0KL0000002e6OfMAI","helpComment":"FOP has provided feedback on your final solution recommendation."}],"list_answers":[{"status":"Yes","questionId":"a0KL0000002e6P4MAI","lastModifyDate":"20.02.2014","comment":null},{"status":"Yes","questionId":"a0KL0000002e6OkMAI","lastModifyDate":"21.02.2014","comment":null},{"status":"In Progress","questionId":"a0KL0000002e6OpMAI","lastModifyDate":"21.02.2014","comment":null},{"status":"Yes","questionId":"a0KL0000002e6NPMAY","lastModifyDate":"21.02.2014","comment":null}]},{"threshold":85.0,"os":{"attributes":{"type":"OpportunityStage","url":"/services/data/v29.0/sobjects/OpportunityStage/01JL000000272xeMAA"},"Id":"01JL000000272xeMAA","MasterLabel":"Contracting"},"map_spqaId_list_qdocs":{},"list_questions":[{"rating":4,"question":"Engineering Project: The customer has signed the MSA and SOW.  TE departments confirming Contracts are signed and approved.","id":"a0KL0000002e6PEMAY","helpComment":"Engineering Project: The customer has signed the MSA and SOW.  TE departments confirming Contracts are signed and approved."},{"rating":2,"question":"Sales project: parts are approved from customer for usage","id":"a0KL0000002e6O9MAI","helpComment":"Sales project: parts are approved from customer for usage"},{"rating":4,"question":"Sales Project: customer order received (contract or order)","id":"a0KL0000002e6NzMAI","helpComment":"Sales Project: customer order received (contract or order)"},{"rating":4,"question":"Engineering project:  product design and technical spec has been approved by the customer","id":"a0KL0000002e6NyMAI","helpComment":"Engineering project:  product design and technical spec has been approved by the customer"}],"list_answers":[{"status":"No","questionId":"a0KL0000002e6PEMAY","lastModifyDate":"20.02.2014","comment":null}]},{"threshold":90.0,"os":{"attributes":{"type":"OpportunityStage","url":"/services/data/v29.0/sobjects/OpportunityStage/01JL000000272xjMAA"},"Id":"01JL000000272xjMAA","MasterLabel":"Won"},"map_spqaId_list_qdocs":{},"list_questions":[{"rating":4,"question":"First quantities for serial production have been shipped.","id":"a0KL0000002e6PdMAI","helpComment":"First quantities for serial production have been shipped."}],"list_answers":[{"status":"Yes","questionId":"a0KL0000002e6PdMAI","lastModifyDate":"20.02.2014","comment":null}]},{"threshold":100.0,"os":{"attributes":{"type":"OpportunityStage","url":"/services/data/v29.0/sobjects/OpportunityStage/01JL000000272xoMAA"},"Id":"01JL000000272xoMAA","MasterLabel":"Production"},"map_spqaId_list_qdocs":{},"list_questions":[{"rating":1,"question":"customer confirmed ramp down and forecast is updated for S&OP","id":"a0KL0000002e6M1MAI","helpComment":"customer confirmed ramp down and forecast is updated for S&OP"}],"list_answers":[]},{"threshold":0.0,"os":{"attributes":{"type":"OpportunityStage","url":"/services/data/v29.0/sobjects/OpportunityStage/01JL000000272zfMAA"},"Id":"01JL000000272zfMAA","MasterLabel":"Ramp down (Demo)"},"map_spqaId_list_qdocs":{},"list_questions":[{"rating":1,"question":"the project is End of Live","id":"a0KL0000002e6NFMAY","helpComment":"the project is End of Live"}],"list_answers":[]},{"threshold":0.0,"os":{"attributes":{"type":"OpportunityStage","url":"/services/data/v29.0/sobjects/OpportunityStage/01JL000000272zzMAA"},"Id":"01JL000000272zzMAA","MasterLabel":"EOL (Demo)"},"map_spqaId_list_qdocs":{},"list_questions":[],"list_answers":[]}];
    
    //========= Show and hide the mask ==============//
    function showMask() {
        $("#mask").show();
        $("#mask").css({
            visibility : 'visible'
        }); 
        //$j( "#progressbar" ).progressbar({ disabled: true });
        /*$j("#progressbar").progressbar({
          value: 0
        });*/
    }
    //Hide the mask.
    function hideMask() {
        $("#mask").css({
            visibility : 'hidden'
        });
        $("#mask").hide();
    }
    
    //========= Show and hide the mask ==============//
    var haveQuestion = false;
    var getCycle = function(){
        var selCycle = oppyjson.Buying_Cycle__c,
            comment = oppyjson.Buying_Cycle_Comment__c ? oppyjson.Buying_Cycle_Comment__c : "",
            leg = buyercycle.length,
            str = "<h3>{!$Label.PMV_over_lab_buyers_cycle}</h3><select class=\"cyclelist\" oldcom=\"" + selCycle + "\"><option value=\"\">--none--</option>";
        for(var i = 0; i < leg; i++) {
            var selected = "";
            if(buyercycle[i] == selCycle) {
                selected = "selected";
            }
            str += "<option value=\"" + buyercycle[i] + "\"" + selected + ">" + buyercycle[i] + "</option>";
        }
        str += "</select><textarea id=\"cycle-comment\" class=\"cycle_comment\" placeholder=\"{!$Label.PMV_accessment_area_info}\" oldcom=\"" + comment + "\">" + comment + "</textarea>";
        return str;
    }
    
    var checkAnswersNum = function(){
        var ansFlag = true;
        $(".answer-con select").each(function(){
            if($(this).attr("oldStatus") != "3") {
                ansFlag = false;
            }
        });
        return ansFlag;
    }
    var drawOppy = function(){
        var str = "", questionNum = 0, quesStageNum = 0, answerNum = 0, disabled = "";
        var len = oppy.length;
        for(var i = 0; i < len; i++){
            var obj = oppy[i], ques = obj.list_questions, ql = ques.length, ans = obj.list_answers, allStage = 0, yesStage = 0, weight = 0, answer = null;
            for(var j = 0; j < ql; j++) {
                questionNum++;
                quesStageNum++;
                var qobj = ques[j];
                allStage += parseInt(qobj.rating);
                for(var a = 0; a < ans.length; a++){
                    if(qobj.id === ans[a].questionId) {
                        answer = ans[a];
                        break;
                    }else{
                        answer = null;
                    }
                }
                if(answer && answer.status === "{!$Label.PMV_assessment_option_yes}") {
                    answerNum++;
                    yesStage += parseInt(qobj.rating);
                }   
            }
            disabled = ""; 
            if(quesStageNum != 0 && haveQuestion === false) {
                haveQuestion = i;
            }
            if(quesStageNum == 0) {
                disabled = " accordion-disabled";
            }
            if(allStage !== 0){
                weight = Math.round((yesStage * 100)/allStage);
            }else {
                weight = 100;
            }
            var status = setProcessStatusByQues(weight, parseInt(obj.threshold));
            str += "<div class=\"accordion-title"+disabled+"\">"+
                "   <span class=\"ui-icon ui-icon-triangle-1-s set-right\"></span>"+
                "   <span class=\"step-name\" stageId=\""+obj.os.Id+"\">" + obj.os.MasterLabel + "</span>"+
                "   <div class=\"ques-info\" threshold=\""+obj.threshold+"\">"+
                "       <label class=\"ques-icon-con\">"+
                "           <span class=\"space\">"+ getQuestionTitle(obj.list_answers, obj.list_questions) + "</span>"+
                "       </label>"+
                "       <span class=\"process-con\">"+
                "       <span class=\"process-status "+status+"\" style=\"width:"+weight+"%\"></span>"+
                "       <span class=\"percent\">"+weight+"%</span>"+
                "       </span>"+
                "       <span class=\"process-info "+status+"\">"+weight+"%</span>"+
                "   </div>"+
                "</div>"+
                "<div class=\"accordion-content\">"+
                "   <div class=\"ques-content\">"+ getQuestionCon(obj.list_answers, obj.list_questions, obj.map_spqaId_list_qdocs) +"</div></div>";
            quesStageNum = 0;
        }
        $(".topButton > ul span").eq(1).html("<label>"+answerNum+"</label>/"+questionNum+" Answers");
        $(".topButton > ul span").eq(1).attr("answer", answerNum);
        //if(questionNum == 0){
            //haveQuestion = false;
        //}
        return str;
    }
    var getQuestionTitle = function(answer, ques){
        var str = "", len = ques.length;
        for(var i = 0; i < len; i++) {
            var obj = ques[i], status = 0, cls = "failed", ans = null;
            for(var a = 0; a < answer.length; a++){
                    if(obj.id === answer[a].questionId) {
                        ans = answer[a];
                        break;
                    }
                }
            if(ans){
                var s = ans.status;
                if (s === "{!$Label.PMV_assessment_option_yes}") {
                    status = 1;
                    cls = "success";
                }
                if (s === "{!$Label.PMV_assessment_option_in_progress}") {
                    status = 2;
                    cls = "process";
                }
                if (s === "{!$Label.PMV_assessment_option_no}") {
                    status = 3;
                    cls = "failed";
                }
            }
            str += "<span class=\"ques-icon "+cls+"\" status=\""+status+"\" questionId=\""+obj.id+"\" weight=\""+obj.rating+"\"></span>";
        }
        return str;
    }
    /**
    * draw question content
    */
    var getQuestionCon = function(answer, ques, docs){
        var str = "", len = ques.length;
        for(var i = 0; i < len; i++) {
            var obj = ques[i], ansComment = "", require = "", cls = "failed", first = "", second = "", third = "", haveDoc = "", docStr = "", status = 3, comment = "", date = "", haveComment = "", ans = null;
            if(docs[obj.id]) {
                var doc = docs[obj.id], docLen = doc.length;
                haveDoc = " sel";
                docStr += "<ul class=\"doc-list\">";
                for(var d = 0; d < docLen; d++) {
                    docStr += "<li><a href=\""+doc[d].url +"\" target=\"_blank\">"+ doc[d].docName +"</a></li>";
                }
                docStr += "</ul>";
            }
            /*if(!obj.Required__c)
                require = "no-sel";*/
            
            for(var a = 0; a < answer.length; a++) {
                if(obj.id === answer[a].questionId) {
                    ans = answer[a];
                    break;
                }
            }
            if(obj.helpComment) {
                    comment = " title=\""+obj.helpComment+"\"";
                    haveComment = " sel";
            }
            if(ans) { 
                var s = ans.status;
                if (s === "{!$Label.PMV_assessment_option_yes}") {
                    status = 1;
                    cls = "success"; 
                    first = "selected";
                }
                if (s === "{!$Label.PMV_assessment_option_in_progress}") {
                    status = 2;
                    cls = "process";
                    second = "selected";
                }
                if (s === "{!$Label.PMV_assessment_option_no}") {
                    status = 3;
                    cls = "failed";
                    third = "selected";
                }
                if(s !== "{!$Label.PMV_assessment_option_yes}" && s !== "{!$Label.PMV_assessment_option_in_progress}" && s !== "{!$Label.PMV_assessment_option_no}"){
                    status = 3;
                    cls = "failed";
                    third = "selected";
                }
                date = ans.lastModifyDate;
                if(ans.comment) {
                    ansComment = ans.comment;
                }
            } else {
                status = 3;
                cls = "failed";
                third = "selected";
            } 
            var seldisable = "";
            if(status == 1 && obj.notReset){
                seldisable = " disabled=\"disabled\"";
            }
            str += "<div class=\"Acc-content\">"+
                   "    <div class=\"required\"></div>"+
                   "    <div class=\"content-div question-con\">"+
                   "        <span>"+obj.question+"</span>"+
                   "<textarea quesId=\""+obj.id+"\" oldcom=\""+ansComment+"\">"+ansComment+"</textarea>"+
                   "    </div>"+
                   "    <div class=\"content-div comment-con\">"+
                   "        <span class=\"edit"+haveDoc+"\""+comment+">"+docStr+"</span>"+
                   "    </div>"+
                   "    <div class=\"content-div answer-con\">"+
                   "        <span class=\"date\"><span class=\"title\">{!$Label.PMV_accessment_answered} </span>"+date+"</span>"+
                   "        <select oldStatus=\""+status+"\" quesId=\""+obj.id+"\""+seldisable+" status=\""+obj.notReset+"\" >"+
                   "            <option value=\"1\" "+first+">{!$Label.PMV_assessment_option_yes}</option>"+
                   "            <option value=\"2\" "+second+">{!$Label.PMV_assessment_option_in_progress}</option>"+
                   "            <option value=\"3\" "+third+">{!$Label.PMV_assessment_option_no}</option>"+
                   "        </select>"+
                   "        <span class=\"ques-icon "+cls+"\"></span>"+
                   "    </div>"+
                   "</div>";
        }
        return str;
    }
    /**
    * if remote action return "SUCCESS" execute this function
    * $obj select
    * $sel quesIcon
    */
    var changeQuesSuccess = function($obj, $sel) {
        var i = parseInt($obj.val()), $status = $obj.next(), $selStage = $sel.parentsUntil(".ques-info").parent();
        //$obj.prev().html("<span class=\"title\">Answered: </span>"+date);
        $sel.removeClass("success process failed");
        $status.removeClass("success process failed");
        switch(i)
        {
            case 1:
                $sel.attr("status", 1).addClass("success");
                $status.addClass("success");
                $obj.val(1);
                break;
            case 2:
                $sel.attr("status", 2).addClass("process");
                $status.addClass("process");
                $obj.val(2);
                break;
            case 3:
                $sel.attr("status", 3).addClass("failed");
                $status.addClass("failed");
                $obj.val(3);
                break;
            default:
                return false;
        }
        var weight = addWeight($selStage), status = setProcessStatusByQues(weight, $selStage.attr("threshold")), $answerCon = $("#tabs > ul span").eq(1);
        setProcessStatus(weight, $selStage);
        $selStage.find(".process-status").removeClass("success process failed").addClass(status);
        var num = parseInt($answerCon.attr("answer"));
        if($obj.attr("oldStatus") != 1 && i === 1) {
            $answerCon.attr("answer", num + 1);
            $answerCon.children("label").html(num + 1);
        }
        if($obj.attr("oldStatus") == 1 && i !== 1) {
            $answerCon.attr("answer", num - 1);
            $answerCon.children("label").html(num - 1);
        }
        $obj.attr("oldStatus", $obj.val());
        return false;
    }
    var showPopup = function(str){
        $("#popup-back, .refresh-popup").show();
        $(".refresh-popup p").html(str);
    }
    var showError = function(str){
        $("#popup-back, .error-popup").show();
        $(".error-popup p").html(str);
    }
    var changeStatus = function($obj, $sel, flag){
        var str = "No";
        if(flag) {
            if($obj.val() == 3) {
                $obj.val(1);
            } else {
                $obj.val(parseInt($obj.val()) + 1);
            }
        }
        if($obj.val() == 1) {
            str = "{!$Label.PMV_assessment_option_yes}";
        }
        if($obj.val() == 2) {
            str = "{!$Label.PMV_assessment_option_in_progress}";
        }
        if($obj.val() == 3) {
            str = "{!$Label.PMV_assessment_option_no}";
        }
        remoteAction($obj, $sel, str, "**@@**");
    }
    var bindBeforeunload = function(){
        $(window).bind("beforeunload", function(){
            return "{!$Label.PMV_accessment_error}";
        });
    };
    var unBindBeforeunload = function(){
                $(window).unbind("beforeunload");
    };
    var remoteCycle = [];
    var changeCycleRemoteAction = function(cycle, comment, status) {
        var oppyId = "{!Id}";
        $(".floatLoading").show();
        var arrCycle = {};
        arrCycle.cycle = cycle;
        arrCycle.comment = comment;
        if(!status){
            remoteCycle.push(arrCycle);
        }
        if(cycleActionFlag){
            cycleActionFlag = false;
            bindBeforeunload();
            var arr = remoteCycle.pop();
            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.ExtOppy_qualifierAccessment.updateOppBCandBCC}", oppyId, arr.cycle, arr.comment, function(result, event) {
                    unBindBeforeunload();
                    cycleActionFlag = true;
                    $(".floatLoading").hide();
                    if (event.status) {
                        if (result != "success") {
                            if(result.indexOf("first error:") != -1)
                            	result = (result.substring(result.indexOf(",", result.lastIndexOf("first error:")) + 2, result.indexOf(": [")));
                            showPopup(result);
                            return false;
                        } else {
                            
                        } 
                    } else {
                        showPopup("{!$Label.PMV_assessment_communication_error}");
                        return false;
                    }
                });
                remoteCycle = [];
        }else{
            if(remoteCycle.length > 0) {
                setTimeout(function(){changeCycleRemoteAction(cycle, comment, true)}, 500);
            }
        }
    }
    var remoteAction = function($obj, $sel, str, comment, status){
        var oppyId = "{!Id}", arrQues = {}, $cyclelist = $(".cyclelist").val();
        if(!status){
            arrQues.questionId = $obj.attr("quesId");
            arrQues.status = str;
            arrQues.comment = comment;
            remoteQues.push(arrQues);
        }
        $(".floatLoading").show();
        if($obj.attr("status") == "true" && $obj.val() == 1) {
            $obj.attr("disabled", true);
        }
        if(actionFlag && remoteQues.length > 0) {
            actionFlag = false;
            bindBeforeunload();
            Visualforce.remoting.Manager.invokeAction("{!$RemoteAction.ExtOppy_qualifierAccessment.saveAnswers}", oppyId, $.toJSON(remoteQues), function(result, event) {
                    if(result && result.indexOf("{") > -1) {
                        $("#convas").html(result);
                        result = $.parseJSON($("#convas").html());
                    } else {
                        result = (result.substring(result.indexOf(",", result.lastIndexOf("first error:")) + 2, result.indexOf(": [")));
                    }
                    actionFlag = true;
                    unBindBeforeunload();
                    hideMask();
                    $(".floatLoading").hide();
                    if (event.status) {
                         
                        if (typeof result == 'object') {
                            for(var i = 0; i < result.length; i++){
                                var resultObj = result[i];
                                var $select = $("select");
                                for(var j = 0; j < $select.size(); j++){
                                    if(resultObj.questionId == $select.eq(j).attr("quesId")){
                                        $select.eq(j).prev().html("<span class=\"title\">{!$Label.PMV_accessment_answered} </span>" + resultObj.lastModifyDate);
                                        
                                        break;
                                    }
                                }
                            }
                        } else {
                            showPopup(result);
                            return false;
                        } 
                    } else {
                        showPopup("{!$Label.PMV_assessment_communication_error}");
                        return false;
                    }
                });
            remoteQues = [];
        } else {
            if(remoteQues.length > 0) {
                setTimeout(function(){remoteAction($obj, $sel, str, comment, true)}, 500);
            }
            
        }
        //hideMask();
        if(str != null && str != "")
            changeQuesSuccess($obj, $sel);
        
    }
    var getWeight = function($obj) {
        var allStage = 0, yesStage = 0;
        $obj.find(".ques-icon").each(function(){
            if($(this).hasClass("success")){
                yesStage += parseInt($(this).attr("weight"));
            }
            allStage += parseInt($(this).attr("weight"));
        });
        return Math.round((yesStage * 100)/allStage);
    }
    var setProcessStatusByQues = function(weight, threshold){
        if(weight === 100)
            return "success";
        if(weight > threshold && weight < 100)
            return "process";
        if(weight <= threshold)
            return "failed"; 
    }
    var setProcessStatus = function(weight, $obj){
        var threshold = $obj.attr("threshold");
        var status = "success";
        if(weight < threshold)
            status = "failed";
        if(weight >= threshold && weight < 100)
            status = "process";
        $obj.children(".process-info").removeClass("success process failed").addClass(status);
    }
    var addWeight = function($obj){
        var weight = getWeight($obj);
        var index = $obj.parentsUntil(".accordion-title").parent().index()/2;
        var $status = $(".content-title tr").eq(index).find(".process-status");
        $status.css("width", weight + "%"); 
        $status.parent().next().html(weight + "%");
        $obj.find(".process-status").css("width", weight + "%");
        $obj.find(".percent").html(weight + "%"); 
        return weight;
    }
    
    
    var canEdit = {!hasAccessEdit};
    $(function() {
    $("head").prepend('<title>Qualifier Assessment</title>');
        $("body").width($(window).width()>1010?$(window).width()-15:1010);
        $("#cycle-container").html(getCycle());
        $("textarea").placeholder();
        $("#accordion").html(drawOppy());
        $( "#tabs" ).tabs();
        $( "#accordion" ).accordion({
            active : false, //haveQuestion,
            collapsible: true,
            heightStyle: "content", 
            beforeActivate: function( event, ui ) {
                if($(event.currentTarget).hasClass("accordion-disabled")) {
                    return false;
                }
            }
            
        });
        $('.edit.sel').click(function(){
            $("#doc-con").show().css({"top": $(this).offset().top, "left": $(this).offset().left-190});
            $("#doc-con .popup-content").html($(this).html());
            
        });
        $("#accordion div").eq(0).css("margin","200px 0 0");
        $(document).click(function(e){
            if( $(e.target).parents("#doc-con").size() === 0 && !$(e.target).hasClass("edit"))
                $("#doc-con").hide();
        }); 
        $(".accordion-content select").change(function(){
            var $sel = $(this).parentsUntil(".accordion-content").parent().prev().find(".ques-icon").eq($(this).parentsUntil(".Acc-content").parent().index());
            $("#cycle-container select").val();
            if($("#cycle-container select").val() != ""){
                changeStatus($(this), $sel);
            }else {
                $(this).val($(this).attr("oldStatus"));
                showError("{!$Label.PMV_assessment_select_error}");
            }
        });
        
         $(".accordion-title .ques-info *").click(function(){
            return false;
         });
         /*$(".accordion-title .ques-icon").click(function(){
            var $sel = $(this).parentsUntil(".accordion-title").parent().next().find("select").eq($(this).index());
            changeStatus($sel, $(this), true);
            return false;
         });*/
         $(".accordion-content textarea").blur(function(){
            if($(this).val() != $(this).attr("oldcom")){
                remoteAction($(this), null, null, $(this).val());
                $(this).attr("oldcom", $(this).val());
            }
         });
         
         $(".cycle_container textarea").blur(function(){
            if($(this).val() != $(this).attr("oldcom")){
                changeCycleRemoteAction($(".cycle_container select").val(), $(this).val());
                $(this).attr("oldcom", $(this).val());
            }
         });
         $(".cycle_container select").change(function(){
            if($(this).val() != $(this).attr("oldcom")){
                if(!(!checkAnswersNum() && $(this).val() == "")){
                    changeCycleRemoteAction($(this).val(), $(".cycle_container textarea").val());
                    $(this).attr("oldcom", $(this).val());
                }else{
                    $(this).val($(this).attr("oldcom"));
                    showError("{!$Label.PMV_assessment_select_null_error}");
                }
            }
         });
         $(".refresh-button").click(function(){
            //hidePopup();
            location.reload();
         });
         $(".content-title-icon2").click(function(){
            $(this).next().toggle();
         });
         $(".tab-back").click(function(){
            location.href='/{!opportunity.id}';
         });
        $(".refresh-button").click(function(){
            $("#popup-back, .refresh-popup").hide();
        });
        $(".error-button").click(function(){
            $("#popup-back, .error-popup").hide();
        });
        $("#criteria, #politicalMap, #portfolio").click(function(){
            window.location.href=$(this).attr("href");
            return false;
        });
        
        if(!canEdit){
            $("select, textarea").attr("disabled","disabled");
        }
    });
  </script>
  <div id="convas" style="display:none;"></div>
  <div id="mask" ></div>
  <div id="doc-con">
    <div class="popup-content">
        <ul class="doc-list"><li><a href="/069L0000000D6thIAC" target="_blank">TE_TeamView_IconCollection</a></li></ul>
    </div>
    <div class="arrow-button">
        <div class="arrow-border"></div>
        <div class="arrow-content"></div>
    </div>
  </div>
  <div id="popup-back"></div>
  <div class="refresh-popup">
    <p>{!$Label.PMV_accessment_lab_refresh_popup_info}</p>
    <input type="button" class="refresh-button" value="{!$Label.PMV_accessment_btn_refresh}"/>
  </div>
  <div class="error-popup">
    <div class="popup-title">
        <span>{!$Label.PMV_lab_error_title}</span>
    </div>
    <p></p>
    <input type="button" class="error-button" value="{!$Label.PMV_accessment_btn_refresh}"/>
  </div>

<div id="tabs">
    <div class="topButton">
	<ul class="floatStyle">
        <li class="tab-back"><span class="backIcon"></span><label>{!$Label.PMV_accessment_leb_back_line_1}<br/>{!$Label.PMV_accessment_leb_back_line_2}</label></li>
        <li class="sel"><a href="#tabs-1">{!$Label.PMV_button_assessment}<span><label>19</label>/20 Answers</span></a></li>
        <li><a href="/apex/ExtOppy_PoliticalMap?Id={!Id}" id="politicalMap">{!$Label.PMV_button_relationships}<span class="political-num">{!countPoliticalMaps} Contacts</span></a></li>
        <li><a href="/apex/ExtOppy_DecisionCriteria?Id={!Id}" id="criteria">{!$Label.PMV_button_criteria}<span>{!countDecisionCriteria} {!$Label.PMV_button_criteria}</span></a></li>
    	<li><a href="/apex/ExtOppy_Portfolio?Id={!Id}" id="portfolio">{!$Label.PMV_Portfolio}<span>&nbsp;</span></a></li>
    </ul>
    <div class="floatLoading">
        <span>{!$Label.PMV_decision_lab_saving_data}</span>
        <img src="{!URLFOR($Resource.jsCss4OrgChart,'css/ui-lightness/images/floatLoading.gif')}"/>
    </div>
</div>
    
    <div id="tabs-1">
        <div id="cycle-container" class="cycle_container">
            
        </div>
        <div id="accordion">
            
            
        </div>
    </div>
    <div id="tabs-2">
    </div>
    <div id="tabs-3">
    </div>
    <div id="tabs-4">
    </div>
</div>

</apex:page>